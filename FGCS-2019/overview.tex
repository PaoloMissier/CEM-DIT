
\subsection{Options for provenance abstraction }  \label{sec:contributions}

Removal of information from a provenance graph can be achieved in a number of ways.
%
 One could simply remove the labels as well as the annotations from individual nodes and relationships, i.e., anonymize part of the graph. Doing so, however, does not hide any of the structure of the process of data production. One could further remove nodes and relationships, for instance nodes \texttt{consolidateAJC} and \texttt{consolidateBNC} in the graph of Fig.~\ref{fig:graph-example}, or  indeed entire sub-graphs. The new graph will be disconnected, however, making it difficult to reconstruct the lineage of the end data product, that is, the sequence of data derivations from the initial inputs to the outcome of the process.
 
Instead, our abstraction operator replaces a sub-graph with a new abstract node, and then ``re-wires'' the new node to the remaining original graph. This has the effect of hiding parts of the process structure as it was represented in the original provenance, while maintaining connectivity. One can still query the lineage, but some of the provenance elements returned by the query will now be an abstraction of the actual data production process.

The main challenge is to guarantee that abstraction produces PROV-compliant  graphs,   maintaining the interoperability guarantees provided from having standardized PROV and ensuring that the results can be consumed by standard PROV tools. We provide a proof of this in the Appendix.
%demonstrate this 



%compatibility with standard PROV tools can consume and 

% would be compromised.
 
%  A second option, which we take here, is to define a rewriting that generates a PROV-compliant graph.




% We view provenance abstraction as a form of graph rewriting. Conceptually, two approaches can be taken when defining the rewriting rules.
 %
% One option is to extend the PROV model  with additional elements (for instance, new types to denote abstract nodes) and a corresponding system of constraints, resulting in an extension PROV' of PROV.
 %
%  In this setting, a legal rewriting is one that transforms a valid PROV graph $\pg$ into a valid PROV' graph $\pg'$, where validity is interpreted as conformance to the PROV' schema.
  %
%  While this approach leads to the definition of a new and possibly interesting model for \textit{abstract provenance}, the interoperability guarantees provided from having standardized PROV would be compromised.
 
%  A second option, which we take here, is to define a rewriting that generates a PROV-compliant graph.
 

 
\subsection{Contributions}
Our specific contribution is the formal definition of a provenance abstraction operator that rewrites  a PROV graph $\pg$ into a new graph $\pg'$, by mapping a set $V_{gr}$ of nodes (for ``vertex in a group'') in $\pg$ to a new abstract node $v_{new}$, and then mapping each relationship involving elements of $V_{gr}$ to a new relationship involving $v_{new}$ in $\pg'$. 
We prove several formal properties of $\pg'$: firstly, schema preservation: if $\pg$ is a PROV graph, that is, it conforms to the PROV data model~\citep{w3c-prov-dm}, then $\pg'$ is also a PROV graph. Secondly, validity preservation: if $\pg$ is \textit{valid}, that is, it satisfies all PROV constraints~\citep{w3c-prov-dm}, then $\pg'$ is also valid. Finally, no spurious dependencies are introduced into $\pg'$: a  relationship involving $v_{new}$ is only created as a result of a mapping from an existing relationship involving elements of $V_{gr}$. Strictly, if $a$ and $e$ are not \textit{directly} related in $\pg$, we guarantee that they are not directly related in $\pg'$. 
Note that new indirect dependencies between two nodes in $\pg'$, manifested as new paths in the graph, may be introduced, however we show that these are always justified by the topology of the underlying graph $\pg$.

Note that, by making the abstraction operator closed with respect to the set of valid PROV graphs, abstraction can be naturally composed, i.e., one can abstract $\pg'$ into some $\pg''$.

Note also that $\pg'$ itself has also an associated provenance graph, that is, a record of the provenance abstraction process as it was applied to $\pg$. 
PROV provides a syntactic facility to maintain the association between a provenance graph and its own provenance, namely using the ``provenance of provenance'' mechanism (i.e., bundles~\citep{w3c-prov-dm}).
